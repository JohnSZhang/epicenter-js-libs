(function(){"use strict";var $,root=this;$="undefined"!=typeof require?require("jQuery"):root.jQuery;var query=function(){return{toMatrixFormat:function(qs){if(null===qs||void 0===qs||""===qs)return";";if("string"==typeof qs||qs instanceof String)return qs;var returnArray=[],OPERATORS=["<",">","!"];$.each(qs,function(key,value){("string"!=typeof value||-1===$.inArray($.trim(value).charAt(0),OPERATORS))&&(value="="+value),returnArray.push(key+value)});var mtrx=";"+returnArray.join(";");return mtrx},toQueryFormat:function(qs){if(null===qs||void 0===qs)return"";if("string"==typeof qs||qs instanceof String)return qs;var returnArray=[];$.each(qs,function(key,value){$.isArray(value)&&(value=value.join(",")),$.isPlainObject(value)&&(value=JSON.stringify(value)),returnArray.push(key+"="+value)});var result=returnArray.join("&");return result},qsToObject:function(qs){if(null===qs||void 0===qs||""===qs)return{};var qsArray=qs.split("&"),returnObj={};return $.each(qsArray,function(index,value){var qKey=value.split("=")[0],qVal=value.split("=")[1];-1!==qVal.indexOf(",")&&(qVal=qVal.split(",")),returnObj[qKey]=qVal}),returnObj},mergeQS:function(qs1,qs2){var obj1=this.qsToObject(this.toQueryFormat(qs1)),obj2=this.qsToObject(this.toQueryFormat(qs2));return $.extend(!0,{},obj1,obj2)},addTrailingSlash:function(url){return url?"/"===url.charAt(url.length-1)?url:url+"/":""}}}();"undefined"!=typeof exports?module.exports=query:(root.F||(root.F={}),root.F.util||(root.F.util={}),root.F.util.query=query)}).call(this),function(){"use strict";var $,root=this;$="undefined"!=typeof require?require("jQuery"):root.jQuery;var run=function(){return{normalizeOperations:function(operations,args){args||(args=[]);var returnList={ops:[],args:[]},_concat=function(arr){return null!==arr&&void 0!==arr?[].concat(arr):[]},_normalizePlainObjects=function(operations,returnList){return returnList||(returnList={ops:[],args:[]}),$.each(operations,function(opn,arg){returnList.ops.push(opn),returnList.args.push(_concat(arg))}),returnList},_normalizeStructuredObjects=function(operation,returnList){return returnList||(returnList={ops:[],args:[]}),returnList.ops.push(operation.name),returnList.args.push(_concat(operation.params)),returnList},_normalizeObject=function(operation,returnList){return(operation.name?_normalizeStructuredObjects:_normalizePlainObjects)(operation,returnList)},_normalizeLiterals=function(operation,args,returnList){return returnList||(returnList={ops:[],args:[]}),returnList.ops.push(operation),returnList.args.push(_concat(args)),returnList},_normalizeArrays=function(operations,arg,returnList){return returnList||(returnList={ops:[],args:[]}),$.each(operations,function(index,opn){$.isPlainObject(opn)?_normalizeObject(opn,returnList):_normalizeLiterals(opn,args[index],returnList)}),returnList};return $.isPlainObject(operations)?_normalizeObject(operations,returnList):$.isArray(operations)?_normalizeArrays(operations,args,returnList):_normalizeLiterals(operations,args,returnList),returnList}}}();"undefined"!=typeof exports?module.exports=run:(root.F||(root.F={}),root.F.util||(root.F.util={}),root.F.util.run=run)}.call(this),function(){"use strict";function inherit(C,P){var F=function(){};F.prototype=P.prototype,C.prototype=new F,C.__super=P.prototype,C.prototype.constructor=C}function classFrom(base,props,staticProps){var child,parent=base;return child=props&&props.hasOwnProperty("constructor")?props.constructor:function(){return parent.apply(this,arguments)},extend(child,parent,staticProps),inherit(child,parent),props&&extend(child.prototype,props),child}var root=this,extend=function(dest){for(var current,obj=Array.prototype.slice.call(arguments,1),j=0;j<obj.length;j++)if(current=obj[j])for(var key in current)dest[key]=current[key];return dest};"undefined"!=typeof require?module.exports=classFrom:(root.F||(root.F={}),root.F.util||(root.F.util={}),root.F.util.classFrom=classFrom)}.call(this),function(){"use strict";function _w(val){if(val&&val.then)return val;var p=$.Deferred();return p.resolve(val),p.promise()}function seq(){function next(p){var cur=list.splice(0,1)[0];return cur?_w(cur(p)).then(next):p}var list=Array.prototype.slice.apply(arguments);return function(seed){return next(seed).fail(seq.fail)}}function MakeSeq(obj){var res={__calls:[],original:obj,then:function(fn){return this.__calls.push(fn),this},start:function(){var _this=this;return this.then(function(run){return _this.__calls.length=0,run}),seq.apply(null,this.__calls)()},fail:function(fn){return seq.fail=fn,this}},funcMaker=function(p,obj){var fn=obj[p].bind(obj);return function(){var args=Array.prototype.slice.apply(arguments);return this.__calls.push(Function.bind.apply(fn,[null].concat(args))),this}};for(var prop in obj)res[prop]="function"==typeof obj[prop]?funcMaker(prop,obj):obj[prop];return res}var $,root=this;$="undefined"!=typeof require?require("jquery"):root.jQuery,"undefined"!=typeof require?module.exports=MakeSeq:(root.F||(root.F={}),root.F.util||(root.F.util={}),root.F.util.makeSequence=MakeSeq)}.call(this),function(){"use strict";var $,root=this;$="undefined"!=typeof require?require("jquery"):root.jQuery;var URLService=function(config){var API_PROTOCOL="https",HOST_API_MAPPING={"forio.com":"api.forio.com","foriodev.com":"api.epicenter.foriodev.com"},publicExports={protocol:API_PROTOCOL,api:"",host:function(){var host=window.location.host;return host&&-1===host.indexOf("localhost")||(host="forio.com"),HOST_API_MAPPING[host]?HOST_API_MAPPING[host]:"api."+host}(),accountPath:function(){var accnt="",path=window.location.pathname.split("/");return path&&"app"===path[1]&&(accnt=path[2]),accnt}(),projectPath:function(){var prj="",path=window.location.pathname.split("/");return path&&"app"===path[1]&&(prj=path[3]),prj}(),getAPIPath:function(api){var PROJECT_APIS=["run","data"],apiPath=this.protocol+"://"+this.host+"/"+api+"/";return-1!==$.inArray(api,PROJECT_APIS)&&(apiPath+=this.accountPath+"/"+this.projectPath+"/"),apiPath}};return $.extend(publicExports,config),publicExports};"undefined"!=typeof exports?module.exports=URLService:(root.F||(root.F={}),root.F.service||(root.F.service={}),root.F.service.URL=URLService)}.call(this),function(){"use strict";var $,root=this,F=root.F;$="undefined"!=typeof require?require("jquery"):root.jQuery;var urlService;urlService="undefined"!=typeof require?require("service/urlService"):F.service.URL;var ConfigurationService=function(config){var defaults={logLevel:"NONE"},serviceOptions=$.extend({},defaults,config);return serviceOptions.server=urlService(serviceOptions.server),{data:serviceOptions,setEnv:function(){},get:function(property){return serviceOptions[property]},set:function(key,value){serviceOptions[key]=value}}};"undefined"!=typeof exports?module.exports=ConfigurationService:(root.F||(root.F={}),root.F.service||(root.F.service={}),root.F.service.Config=ConfigurationService)}.call(this),function(){"use strict";var root=this,F=root.F,$=root.jQuery,qutils=F.util.query,AjaxHTTP=function(config){var defaults={url:"",contentType:"application/json",headers:{},statusCode:{404:$.noop},parameterParser:qutils.toQueryFormat,xhrFields:{withCredentials:!0}},transportOptions=$.extend({},defaults,config),result=function(d){return $.isFunction(d)?d():d},connect=function(method,params,connectOptions){params=result(params),params=$.isPlainObject(params)||$.isArray(params)?JSON.stringify(params):params;var options=$.extend(!0,{},transportOptions,connectOptions,{type:method,data:params}),ALLOWED_TO_BE_FUNCTIONS=["data","url"];if($.each(options,function(key,value){$.isFunction(value)&&-1!==$.inArray(key,ALLOWED_TO_BE_FUNCTIONS)&&(options[key]=value())}),options.logLevel&&"DEBUG"===options.logLevel){console.log(options.url);var oldSuccessFn=options.success||$.noop;options.success=function(response){console.log(response),oldSuccessFn.apply(this,arguments)}}return $.ajax(options)},publicAPI={get:function(params,ajaxOptions){var options=$.extend({},transportOptions,ajaxOptions);return params=options.parameterParser(result(params)),connect.call(this,"GET",params,options)},post:function(){return connect.apply(this,["post"].concat([].slice.call(arguments)))},patch:function(){return connect.apply(this,["patch"].concat([].slice.call(arguments)))},put:function(){return connect.apply(this,["put"].concat([].slice.call(arguments)))},"delete":function(params,ajaxOptions){var options=$.extend({},transportOptions,ajaxOptions);if(params=options.parameterParser(result(params)),$.trim(params)){var delimiter=-1===result(options.url).indexOf("?")?"?":"&";options.url=result(options.url)+delimiter+params}return connect.call(this,"DELETE",null,options)},head:function(){return connect.apply(this,["head"].concat([].slice.call(arguments)))},options:function(){return connect.apply(this,["options"].concat([].slice.call(arguments)))}};return $.extend(this,publicAPI)};"undefined"!=typeof exports?module.exports=AjaxHTTP:(root.F||(root.F={}),root.F.transport||(root.F.transport={}),root.F.transport.Ajax=AjaxHTTP)}.call(this),function(){"use strict";var transport,root=this,F=root.F,isNode=!1;transport="undefined"!=typeof require?require(isNode?"transport/node-http-transport":"transport/ajax-http-transport"):F.transport.Ajax,"undefined"!=typeof exports?module.exports=transport:(root.F||(root.F={}),root.F.factory||(root.F.factory={}),root.F.factory.Transport=transport)}.call(this),function(){"use strict";var $,ConfigService,root=this,F=root.F;"undefined"!=typeof require?($=require("jquery"),ConfigService=require("util/configuration-service")):($=root.jQuery,ConfigService=F.service.Config);var CookieStore=function(config){var defaults={root:"/",domain:".forio.com"},serviceOptions=$.extend({},defaults,config),publicAPI={set:function(key,value,options){var setOptions=$.extend(!0,{},serviceOptions,options),domain=setOptions.domain,path=setOptions.root;return document.cookie=encodeURIComponent(key)+"="+encodeURIComponent(value)+(domain?"; domain="+domain:"")+(path?"; path="+path:""),value},get:function(key){var cookieReg=new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(key).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),val=document.cookie.replace(cookieReg,"$1");return val=decodeURIComponent(val)||null},remove:function(key,options){var remOptions=$.extend(!0,{},serviceOptions,options),domain=remOptions.domain,path=remOptions.root;return document.cookie=encodeURIComponent(key)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(domain?"; domain="+domain:"")+(path?"; path="+path:""),key},destroy:function(){for(var aKeys=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),nIdx=0;nIdx<aKeys.length;nIdx++){var cookieKey=decodeURIComponent(aKeys[nIdx]);this.remove(cookieKey)}return aKeys}};$.extend(this,publicAPI)};"undefined"!=typeof exports?module.exports=CookieStore:(root.F||(root.F={}),root.F.store||(root.F.store={}),root.F.store.Cookie=CookieStore)}.call(this),function(){"use strict";var dataStore,root=this,F=root.F,isNode=!1;dataStore="undefined"!=typeof require?require(isNode?"./session-store.js":"./cookie-store.js"):F.store.Cookie,"undefined"!=typeof exports?module.exports=dataStore:(root.F||(root.F={}),root.F.factory||(root.F.factory={}),root.F.factory.Store=dataStore)}.call(this),function(){"use strict";var $,ConfigService,qutil,TransportFactory,StorageFactory,root=this,F=root.F;"undefined"!=typeof require?($=require("jquery"),ConfigService=require("util/configuration-service"),qutil=require("util/query-util"),StorageFactory=require("store/store-factory")):($=root.jQuery,ConfigService=F.service.Config,qutil=F.util.query,TransportFactory=F.factory.Transport,StorageFactory=F.factory.Store);var DataService=function(config){var store=new StorageFactory({synchronous:!0}),defaults={root:"/",token:store.get("epicenter.project.token")||"",apiKey:"",domain:"forio.com",transport:{}},serviceOptions=$.extend({},defaults,config),urlConfig=new ConfigService(serviceOptions).get("server");serviceOptions.account&&(urlConfig.accountPath=serviceOptions.account),serviceOptions.project&&(urlConfig.projectPath=serviceOptions.project);var getURL=function(key,root){root||(root=serviceOptions.root);var url=urlConfig.getAPIPath("data")+qutil.addTrailingSlash(root);return key&&(url+=qutil.addTrailingSlash(key)),url},httpOptions=$.extend(!0,{},serviceOptions.transport,{url:getURL});serviceOptions.token&&(httpOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new TransportFactory(httpOptions),publicAPI={query:function(key,query,outputModifier,options){var params=$.extend(!0,{q:query},outputModifier),httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions.url=getURL(key,httpOptions.root),http.get(params,httpOptions)},save:function(key,value,options){var attrs;"object"==typeof key?(attrs=key,options=value):(attrs={})[key]=value;var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions.url=getURL("",httpOptions.root),http.post(attrs,httpOptions)},saveAs:function(key,value,options){var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions.url=getURL(key,httpOptions.root),http.put(value,httpOptions)},load:function(key,outputModifier,options){var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions.url=getURL(key,httpOptions.root),http.get(outputModifier,httpOptions)},remove:function(keys,options){var params,httpOptions=$.extend(!0,{},serviceOptions,options);return $.isArray(keys)?params={id:keys}:(params="",httpOptions.url=getURL(keys,httpOptions.root)),http.delete(params,httpOptions)}};$.extend(this,publicAPI)};"undefined"!=typeof exports?module.exports=DataService:(root.F||(root.F={}),root.F.service||(root.F.service={}),root.F.service.Data=DataService)}.call(this),function(){"use strict";var $,ConfigService,qutil,TransportFactory,StorageFactory,root=this,F=root.F;"undefined"!=typeof require?($=require("jquery"),ConfigService=require("util/configuration-service"),qutil=require("util/query-util"),StorageFactory=require("store/store-factory")):($=root.jQuery,ConfigService=F.service.Config,qutil=F.util.query,TransportFactory=F.factory.Transport,StorageFactory=F.factory.Store);var AuthService=function(config){var defaults={store:{synchronous:!0},userName:"",password:"",account:"",transport:{}},serviceOptions=$.extend({},defaults,config),urlConfig=new ConfigService(serviceOptions).get("server");serviceOptions.account||(serviceOptions.account=urlConfig.accountPath);var httpOptions=$.extend(!0,{},serviceOptions.transport,{url:urlConfig.getAPIPath("authentication")}),http=new TransportFactory(httpOptions),EPI_COOKIE_KEY="epicenter.project.token",store=new StorageFactory(serviceOptions.store),token=store.get(EPI_COOKIE_KEY)||"",publicAPI={store:store,login:function(options){var httpOptions=$.extend(!0,{success:$.noop},serviceOptions,options);if(!httpOptions.userName||!httpOptions.password)throw new Error("No username or password specified.");var postParams={userName:httpOptions.userName,password:httpOptions.password};httpOptions.account&&(postParams.account=httpOptions.account);var oldSuccessFn=httpOptions.success;return httpOptions.success=function(response){serviceOptions.password=httpOptions.password,serviceOptions.userName=httpOptions.userName,token=response.access_token,store.set(EPI_COOKIE_KEY,token),oldSuccessFn.apply(this,arguments)},http.post(postParams,httpOptions)},logout:function(options){return store.remove(EPI_COOKIE_KEY,options)},getToken:function(options){var httpOptions=$.extend(!0,{success:$.noop},serviceOptions,options),$d=$.Deferred();return token?$d.resolve(token):this.login(httpOptions).then($d.resolve),$d.promise()}};$.extend(this,publicAPI)};"undefined"!=typeof exports?module.exports=AuthService:(root.F||(root.F={}),root.F.service||(root.F.service={}),root.F.service.Auth=AuthService)}.call(this),function(){"use strict";var $,ConfigService,qutil,rutil,futil,TransportFactory,root=this,F=root.F;"undefined"!=typeof require?($=require("jquery"),ConfigService=require("utils/configuration-service"),qutil=require("util/query-util"),rutil=require("util/run-util"),futil=require("util/promisify-util")):($=root.jQuery,ConfigService=F.service.Config,qutil=F.util.query,rutil=F.util.run,futil=F.util,TransportFactory=F.factory.Transport);var VariablesService=function(config){var defaults={runService:null},serviceOptions=$.extend({},defaults,config),getURL=function(){return serviceOptions.runService.urlConfig.getFilterURL()+"variables/"},httpOptions={url:getURL};serviceOptions.token&&(httpOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new TransportFactory(httpOptions),publicAPI={load:function(variable,outputModifier,options){var httpOptions=$.extend(!0,{},serviceOptions,options);return http.get(outputModifier,$.extend({},httpOptions,{url:getURL()+variable+"/"}))},query:function(query,outputModifier,options){var httpOptions=$.extend(!0,{},serviceOptions,options);return $.isArray(query)&&(query={include:query}),$.extend(query,outputModifier),http.get(query,httpOptions)},save:function(variable,val,options){var attrs;"object"==typeof variable?(attrs=variable,options=val):(attrs={})[variable]=val;var httpOptions=$.extend(!0,{},serviceOptions,options);return http.patch.call(this,attrs,httpOptions)}};$.extend(this,publicAPI)};"undefined"!=typeof exports?module.exports=VariablesService:(root.F||(root.F={}),root.F.service||(root.F.service={}),root.F.service.Variables=VariablesService)}.call(this),function(){"use strict";var $,ConfigService,qutil,rutil,futil,TransportFactory,VariablesService,StorageFactory,root=this,F=root.F;"undefined"!=typeof require?($=require("jquery"),ConfigService=require("util/configuration-service"),VariablesService=require("service/variables-api-service"),qutil=require("util/query-util"),rutil=require("util/run-util"),futil=require("util/promisify-util"),StorageFactory=require("store/store-factory")):($=root.jQuery,ConfigService=F.service.Config,VariablesService=F.service.Variables,qutil=F.util.query,rutil=F.util.run,futil=F.util,TransportFactory=F.factory.Transport,StorageFactory=F.factory.Store);var RunService=function(config){var store=new StorageFactory({synchronous:!0}),defaults={token:store.get("epicenter.project.token")||"",account:"",project:"",filter:"",success:$.noop,error:$.noop,transport:{}},serviceOptions=$.extend({},defaults,config),urlConfig=new ConfigService(serviceOptions).get("server");serviceOptions.account&&(urlConfig.accountPath=serviceOptions.account),serviceOptions.project&&(urlConfig.projectPath=serviceOptions.project),urlConfig.filter=";",urlConfig.getFilterURL=function(){var url=urlConfig.getAPIPath("run"),filter=qutil.toMatrixFormat(serviceOptions.filter);return filter&&(url+=filter+"/"),url};var httpOptions=$.extend(!0,{},serviceOptions.transport,{url:urlConfig.getFilterURL});serviceOptions.token&&(httpOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new TransportFactory(httpOptions),setFilterOrThrowError=function(options){if(options.filter&&(serviceOptions.filter=options.filter),!serviceOptions.filter)throw new Error("No filter specified to apply operations against")},publicAsyncAPI={urlConfig:urlConfig,create:function(params,options){var createOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath("run")});"string"==typeof params&&(params={model:params});var oldSuccess=createOptions.success;return createOptions.success=function(response){return serviceOptions.filter=response.id,oldSuccess.apply(this,arguments)},http.post(params,createOptions)},query:function(qs,outputModifier,options){serviceOptions.filter=qs;var httpOptions=$.extend(!0,{},serviceOptions,options);return http.get(outputModifier,httpOptions)},filter:function(filter,outputModifier,options){$.isPlainObject(serviceOptions.filter)?$.extend(serviceOptions.filter,filter):serviceOptions.filter=filter;var httpOptions=$.extend(!0,{},serviceOptions,options);return http.get(outputModifier,httpOptions)},load:function(runID,filters,options){serviceOptions.filter=runID;var httpOptions=$.extend(!0,{},serviceOptions,options);return http.get(filters,httpOptions)},save:function(attributes,options){var httpOptions=$.extend(!0,{},serviceOptions,options);return setFilterOrThrowError(httpOptions),http.patch(attributes,httpOptions)},"do":function(operation,params,options){var opsArgs,postOptions;options?(opsArgs=params,postOptions=options):$.isPlainObject(params)?(opsArgs=null,postOptions=params):opsArgs=params;var result=rutil.normalizeOperations(operation,opsArgs),httpOptions=$.extend(!0,{},serviceOptions,postOptions);setFilterOrThrowError(httpOptions);var prms=result.args[0].length&&null!==result.args[0]&&void 0!==result.args[0]?result.args[0]:[];return http.post({arguments:prms},$.extend(!0,{},httpOptions,{url:urlConfig.getFilterURL()+"operations/"+result.ops[0]+"/"}))},serial:function(operations,params,options){var opParams=rutil.normalizeOperations(operations,params),ops=opParams.ops,args=opParams.args,me=this,$d=$.Deferred(),postOptions=$.extend(!0,{},serviceOptions,options),doSingleOp=function(){var op=ops.shift(),arg=args.shift();me.do(op,arg,{success:function(){ops.length?doSingleOp():($d.resolve.apply(this,arguments),postOptions.success.apply(this,arguments))},error:function(){$d.reject.apply(this,arguments),postOptions.error.apply(this,arguments)}})};return doSingleOp(),$d.promise()},parallel:function(operations,params,options){for(var $d=$.Deferred(),opParams=rutil.normalizeOperations(operations,params),ops=opParams.ops,args=opParams.args,postOptions=$.extend(!0,{},serviceOptions,options),queue=[],i=0;i<ops.length;i++)queue.push(this.do(ops[i],args[i]));return $.when.apply(this,queue).done(function(){$d.resolve.apply(this,arguments),postOptions.success.apply(this.arguments)}).fail(function(){$d.reject.apply(this,arguments),postOptions.error.apply(this.arguments)}),$d.promise()}},publicSyncAPI={variables:function(config){var vs=new VariablesService($.extend(!0,{},serviceOptions,config,{runService:this}));return vs}};$.extend(this,publicAsyncAPI),$.extend(this,publicSyncAPI)};"undefined"!=typeof exports?module.exports=RunService:(root.F||(root.F={}),root.F.service||(root.F.service={}),root.F.service.Run=RunService)}.call(this),function(){"use strict";var classFrom,Base,root=this,F=root.F;"undefined"!=typeof require?(classFrom=require("../../util/inherit"),Base={},module.exports=classFrom(Base,{})):(classFrom=F.util.classFrom,Base={},root.F||(root.F={}),root.F.manager||(root.F.manager={}),root.F.manager.strategy||(root.F.manager.strategy={}),root.F.manager.strategy.identity=classFrom(Base,{}))}.call(this),function(){"use strict";function setRunCookie(cookieName,run){var path="/";if(window)if(/\.html/.test(window.location.pathname.split("/"))){var parts=window.location.pathname.split("/");parts.pop(),path=parts.join("/")}else path=window.location.pathname;cookies.set(cookieName,JSON.stringify({runId:run.id}),{root:path})}var cookies,makeSeq,classFrom,$,Base,root=this,F=root.F;"undefined"!=typeof require?($=require("jquery"),cookies=new require("../../store/cookie-store")({domain:null}),makeSeq=require("../../util/make-sequence"),classFrom=require("../util/inherit"),Base=require("./identity-strategy")):($=root.jQuery,cookies=new F.store.Cookie({domain:null}),makeSeq=F.util.makeSequence,classFrom=F.util.classFrom,Base=F.manager.strategy.identity);var defaults={cookieName:"epicenter-scenario"},Strategy=classFrom(Base,{constructor:function(runService,condition,options){if(null==condition)throw new Error("Conditional strategy needs a condition to createte a run");this.run=makeSeq(runService),this.condition="function"!=typeof condition?function(){return condition}:condition,this.options=$.extend(!0,{},defaults,options)},reset:function(){var _this=this;return this.run.create({model:this.options.model}).then(function(run){return setRunCookie(_this.options.cookieName,run),run.freshlyCreated=!0,run}).start()},getRun:function(model){var session=JSON.parse(cookies.get(this.options.cookieName));return session&&session.runId?this._loadAndCheck(session,model):this.reset()},_loadAndCheck:function(session,model){var shouldCreate=!1,_this=this;return this.run.load(session.runId,null,{success:function(run,msg,headers){shouldCreate=_this.condition.call(_this,run,headers)}}).then(function(run){return shouldCreate?_this.run.original.create(model).then(function(run){return setRunCookie(_this.options.cookieName,run),run.freshlyCreated=!0,run}):run}).start()}});"undefined"!=typeof require?module.exports=Strategy:(root.F||(root.F={}),root.F.manager||(root.F.manager={}),root.F.manager.strategy||(root.F.manager.strategy={}),root.F.manager.strategy["conditional-creation"]=Strategy)}.call(this),function(){"use strict";var classFrom,ConditionalStrategy,root=this,F=root.F;"undefined"!=typeof require?(classFrom=require("../../utils/inherit"),ConditionalStrategy=require("./conditional-creation-strategy")):(classFrom=F.util.classFrom,ConditionalStrategy=F.manager.strategy["conditional-creation"]);var __super=ConditionalStrategy.prototype,Strategy=classFrom(ConditionalStrategy,{constructor:function(runService,options){__super.constructor.call(this,runService,this.createIf,options)},createIf:function(){return!0}});"undefined"!=typeof require?module.exports=Strategy:(root.F||(root.F={}),root.F.manager||(root.F.manager={}),root.F.manager.strategy["always-new"]=Strategy)}.call(this),function(){"use strict";var classFrom,ConditionalStrategy,root=this,F=root.F;"undefined"!=typeof require?(classFrom=require("../../util/inherit"),ConditionalStrategy=require("./conditional-creation-strategy")):(classFrom=F.util.classFrom,ConditionalStrategy=F.manager.strategy["conditional-creation"]);var __super=ConditionalStrategy.prototype,Strategy=classFrom(ConditionalStrategy,{constructor:function(runService,options){__super.constructor.call(this,runService,this.createIf,options)},createIf:function(){return!1}});"undefined"!=typeof require?module.exports=Strategy:(root.F||(root.F={}),root.F.manager||(root.F.manager={}),root.F.manager.strategy||(root.F.manager.strategy={}),root.F.manager.strategy["new-if-missing"]=Strategy)}.call(this),function(){"use strict";var classFrom,ConditionalStrategy,root=this,F=root.F;"undefined"!=typeof require?(classFrom=require("../../util/inherit"),ConditionalStrategy=require("./conditional-creation-strategy")):(classFrom=F.util.classFrom,ConditionalStrategy=F.manager.strategy["conditional-creation"]);var __super=ConditionalStrategy.prototype,Strategy=classFrom(ConditionalStrategy,{constructor:function(runService,options){__super.constructor.call(this,runService,this.createIf,options)},createIf:function(run,headers){return"persistent"===headers.getResponseHeader("pragma")}});"undefined"!=typeof require?module.exports=Strategy:(root.F||(root.F={}),root.F.manager||(root.F.manager={}),root.F.manager.strategy||(root.F.manager.strategy={}),root.F.manager.strategy["new-if-persisted"]=Strategy)}.call(this),function(){"use strict";var classFrom,ConditionalStrategy,root=this,F=root.F;"undefined"!=typeof require?(classFrom=require("../../util/inherit"),ConditionalStrategy=require("./conditional-creation-strategy")):(classFrom=F.util.classFrom,ConditionalStrategy=F.manager.strategy["conditional-creation"]);var __super=ConditionalStrategy.prototype,Strategy=classFrom(ConditionalStrategy,{constructor:function(runService,options){__super.constructor.call(this,runService,this.createIf,options)},createIf:function(run,headers){return"persistent"===headers.getResponseHeader("pragma")||run.initialized}});"undefined"!=typeof require?module.exports=Strategy:(root.F||(root.F={}),root.F.manager||(root.F.manager={}),root.F.manager.strategy||(root.F.manager.strategy={}),root.F.manager.strategy["new-if-simulated"]=Strategy)}.call(this),function(){"use strict";var root=this,F=root.F;"undefined"!=typeof require?module.exports={"new-if-simulated":require("./run-strategies/new-if-simulated-strategy"),"new-if-persisted":require("./run-strategies/new-if-persisted-strategy"),"new-if-missing":require("./run-strategies/new-if-missing-strategy"),"always-new":require("./run-strategies/always-new-strategy")}:(root.F||(root.F={}),root.F.manager||(root.F.manager={}),root.F.manager.strategy.map={"new-if-simulated":F.manager.strategy["new-if-simulated"],"new-if-persisted":F.manager.strategy["new-if-persisted"],"new-if-missing":F.manager.strategy["new-if-missing"],"always-new":F.manager.strategy["always-new"]})}.call(this),function(){"use strict";function RunManager(options){this.options=$.extend(!0,{},defaults,options),this.run=this.options.run||new F.service.Run(this.options);var StrategyCtor="function"==typeof this.options.strategy?this.options.strategy:strategiesMap[this.options.strategy];if(!StrategyCtor)throw new Error("Specified run creation strategy was invalid:",this.options.strategy);this.strategy=new StrategyCtor(this.run,this.options)}var $,strategiesMap,root=this,F=root.F;"undefined"!=typeof require?($=require("jquery"),strategiesMap=require("./strategies/strategies-map")):($=root.jQuery,strategiesMap=F.manager.strategy.map);var defaults={strategy:"new-if-simulated"};RunManager.prototype={getRun:function(){return this.strategy.getRun(this.options.model)},reset:function(){return this.strategy.reset()}},"undefined"!=typeof exports?module.exports=RunManager:(root.F||(root.F={}),root.F.manager||(root.F.manager={}),root.F.manager.RunManager=RunManager)}.call(this),function(){"use strict";function ScenarioManager(options){this.options=$.extend(!0,{},defaults,options),this.runService=this.options.run||new F.service.Run(this.options)}var $,root=this,F=root.F;$="undefined"!=typeof require?require("jquery"):root.jQuery;var defaults={validFilter:{saved:!0}};ScenarioManager.prototype={getRuns:function(filter){return this.filter=$.extend(!0,{},this.options.validFilter,filter),this.runService.query(this.filter)},loadVariables:function(vars){return this.runService.query(this.filter,{include:vars})},save:function(run,meta){return this._getService(run).save($.extend(!0,{},{saved:!0},meta))},archive:function(run){return this._getService(run).save({saved:!1})},_getService:function(run){if("string"==typeof run)return new F.service.Run($.extend(!0,{},this.options,{filter:run}));if("object"==typeof run&&run instanceof F.service.Run)return run;throw new Error("Save method requires a run service or a runId")},getRun:function(runId){return new F.service.Run($.extend(!0,{},this.options,{filter:runId}))}},"undefined"!=typeof require?module.exports=ScenarioManager:(root.F||(root.F={}),root.F.manager||(root.F.manager={}),root.F.manager.strategy||(root.F.manager.strategy={}),root.F.manager.ScenarioManager=ScenarioManager)}.call(this);
//# sourceMappingURL=epicenter.min.js.map